function Chat(){this.receive=function(a){if(Token==a.token){return false}if(Hash==a.hash){this.html("",a.message);if($("#chat:visible").length==0){var b=parseInt($("#bar-navigation .notify").text())+1;$("#bar-navigation .notify").text((b>8)?"+9":b).show()}}};this.html=function(a,b){$("#chat > .messages").append('<li class="'+a+'"> <span>'+b+"</span> </li>");$("#navigation-folders ul#chat .messages").scrollTop($("#navigation-folders ul#chat .messages").prop("scrollHeight"))}}function Sync(){this.receive=function(b){var a="";if(Token==b.token){return false}if(Hash==b.hash){if($('.tabs li.active[data-location="'+b.location+'"][data-file="'+b.file+'"]').length>0){editor.getDoc().setValue(b.code)}else{if($('#guard-codes li[data-location="'+b.location+"/"+b.file+'"]').length>0){$('#guard-codes li[data-location="'+b.location+"/"+b.file+'"] textarea').val(b.code)}else{$("#guard-codes").prepend('<li data-location="'+b.location+"/"+b.file+'"> <textarea>'+b.code+"</textarea> </li>")}}$(".CodeMirror").addClass("inative");clearInterval(a);a=setTimeout(function(){$(".CodeMirror").removeClass("inative")},3000)}}}var Chat=new Chat(),Sync=new Sync();function BrainSocket(b,a){this.connection=b;this.Event=a;this.connection.BrainSocket=this;this.connection.digestMessage=function(d){try{var c=JSON.parse(d);if(c.server&&c.server.event){this.BrainSocket.Event.fire(c.server.event,c)}else{this.BrainSocket.Event.fire(c.client.event,c)}}catch(f){this.BrainSocket.Event.fire(d)}};this.connection.onerror=function(c){console.log(c)};this.connection.onmessage=function(d){var c=JSON.parse(d.data);this.digestMessage(d.data);switch(c.client.event){case"chat.send":Chat.receive(c.client.data);break;case"sync.send":Sync.receive(c.client.data);break}};this.success=function(c){this.message("app.success",c)};this.error=function(c){this.message("app.error",c)};this.message=function(d,e){var c={client:{}};c.client.event=d;if(!e){e=[]}c.client.data=e;this.connection.send(JSON.stringify(c))}}window.app={};app.BrainSocket=new BrainSocket(new WebSocket("ws://"+Server+":8080"),new BrainSocketPubSub());$(document).ready(function(){setTimeout(function(){app.BrainSocket.message("app.init",{hash:Hash,visitor:Visitor,user:User})},500)});$("#chat textarea").keyup(function(a){if(a.keyCode==13){Chat.html("me",$(this).val());$("#navigation-folders ul#chat .messages").scrollTop($("#navigation-folders ul#chat .messages").prop("scrollHeight"));app.BrainSocket.message("chat.send",{message:$(this).val(),hash:Hash,token:Token});$(this).val("");return false}});